class RedirectionList extends Charcoal.Admin.Widget{defaultRowData(){return{path:"",redirect:"/",redirectionCode:301}}constructor(e){super(e),this.table=null,this.selector=e.selector,this.objectType=e.object_type,this.tableData=JSON.parse(e.redirections)||[],this.initialData=JSON.parse(e.redirections)||[]}init(){this.table=new Tabulator(this.selector+" .js-tabulator",{data:this.tableData,maxHeight:"100vh",autoResize:!0,layout:"fitColumns",columns:[{field:"id",visible:!1},{title:"Path",field:"path",editor:"input",editorParams:{selectContents:!0}},{title:"Redirection",field:"redirect",editor:"input",editorParams:{selectContents:!0}},{title:"Type",field:"redirectionCode",editor:"list",editorParams:{allowEmpty:!1,values:{301:"Permanent (301)",302:"Temporary (302)"},defaultValue:301,listOnEmpty:!0,freetext:!1},formatter:"lookup",formatterParams:{301:"Permanent (301)",302:"Temporary (302)"}},{title:"Redirect children",field:"redirectChildren",editor:"tickCross",formatter:"tickCross",editorParams:{},visible:!1},{headerSort:!1,width:150,cellClick:(e,t)=>{const i={"js-delete":()=>this.deleteRow(t.getRow()),"js-clone":()=>this.cloneRow(t.getRow()),"js-add-below":()=>this.addRow({},!1,t.getRow())};Object.keys(i).forEach((t=>{e.target.classList.contains(t)&&i[t]()}))},formatter:()=>'<div class="btn-group" role="group" aria-label="Basic example">\n                            <button type="button" class="btn btn-danger js-delete" title="Delete"><i class=\'fa fa-trash\' style="pointer-events: none;"></i></button>\n\x3c!--                            <button type="button" class="btn btn-secondary js-clone" title="Clone"><i class=\'fa fa-clone\' style="pointer-events: none;"></i></button>--\x3e\n\x3c!--                            <button type="button" class="btn btn-success js-add-below" title="Add row under"><i class=\'fa fa-plus\' style="pointer-events: none;"></i></button>--\x3e\n                        </div>'}]}),this.registerEvents()}registerEvents(){this.table.on("dataChanged",(e=>{this.toggleUpdateButtonState(e)})),this.table.on("tableBuilt",(()=>{this.element().removeClass("is-loading")})),this.element().on(`click.${this.type()}`,".js-add-row",(()=>{this.addRow(this.defaultRowData())})),this.element().on(`click.${this.type()}`,".js-update",(()=>{let e=this.table.getData().filter((e=>!this.initialData.find((t=>JSON.stringify(t)===JSON.stringify(e)))));this.toggleUpdateLoader(!0),fetch("/admin/redirections/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>(200!==e.status&&e.status,e.json()))).then((e=>{console.log("Request complete! response:",e),e.feedbacks&&Charcoal.Admin.feedback(e.feedbacks).dispatch(),e.redirections&&(this.table.setData(e.redirections),this.initialData=JSON.parse(JSON.stringify(e.redirections)),this.toggleUpdateButtonState(e.redirections)),this.toggleUpdateLoader(!1)})).catch((e=>{console.error("Error:",e)}))}))}toggleUpdateButtonState(e){this.element().find(".js-update").prop("disabled",JSON.stringify(e)===JSON.stringify(this.initialData))}deleteRow(e){this.confirm({title:"Delete Row",message:"Are you sure you wish to proceed with deleting this row?"},(()=>{if(!e.getData().id)return e.delete(),void this.table.redraw();const t={obj_type:this.objectType,obj_id:e.getData().id};fetch("/admin/object/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json())).then((t=>{t.success&&(e.delete(),this.table.redraw()),t.feedbacks&&Charcoal.Admin.feedback(t.feedbacks).dispatch()}))}))}cloneRow(e){this.addRow(e.getData(),!1,e)}addRow(e={},t=!1,i=null){this.table.addRow(e,t,i).then((e=>{this.table.redraw();let t=e.getCell("path").getElement();return setTimeout((()=>t.focus()),10),e}))}toggleUpdateLoader(e){const t=this.element().find(".js-update"),i=t.find(".js-loader");e?(t.children().addClass("d-none"),i.removeClass("d-none")):(t.children().removeClass("d-none"),i.addClass("d-none"))}destroy(){this.element().off(`${this.type()}`)}}Charcoal.Admin.Redirect_Widget_Redirections_List=RedirectionList;export{RedirectionList};